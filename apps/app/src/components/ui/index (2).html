<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><div className="flex-1 p-3 overflow-hidden">
  <div className="max-w-4xl mx-auto h-full flex flex-col space-y-3">
    {/* Header */}
    <div className="text-center flex-shrink-0">
      <h1 className="text-2xl font-bold">ðŸš€ The Great-G-Stack </h1>
      <p className="text-sm text-gray-600">
        Build your perfect development stack with AI-powered setup generation
      </p>
    </div>

    {/* Progress */}
    <Card className="flex-shrink-0 py-4">
      <CardContent>
        <div className="space-y-1">
          <div className="flex justify-between text-xs">
            <span>Step {currentStep + 1} of 18</span>
            <span>{Math.round(progress)}% Complete</span>
          </div>
          <Progress value={progress} className="w-full h-2" />
        </div>
      </CardContent>
    </Card>

    {/* Current Selections Summary */}
    {currentStep !== 17 && Object.keys(selectedStack).length > 0 && (
      <div className="flex-shrink bg-white py-4 border-2 rounded-lg p-4">
        <div className="py-2 font-bold">
          <div className="text-sm">Current Selections</div>
        </div>
        <div className="py-2">
          <div className="flex flex-wrap gap-1">
            {Object.entries(selectedStack).map(([key, value]) => {
              if (key === "aiPrompt") return null
              return (
                <div key={key} className="flex flex-wrap gap-1">
                  {Array.isArray(value) ? (
                    value.map((item) => (
                      <Badge key={item.id} variant="outline" className="text-xs">
                        {item.name}
                      </Badge>
                    ))
                  ) : (
                    <Badge variant="outline" className="text-xs">
                      {value.name}
                    </Badge>
                  )}
                </div>
              )
            })}
          </div>
        </div>
      </div>
    )}

    {/* Main Step Card */}
    <Card className="flex-1 flex flex-col overflow-hidden">
      <CardHeader className="flex-shrink-0">
        <CardTitle className="flex items-center gap-1 text-lg">
          {currentStepData.key === "aiPrompt" && <Sparkles className="h-4 w-4 text-purple-500" />}
          {currentStepData.title}
          {currentStepData.required && <span className="text-red-500 ml-1">*</span>}
        </CardTitle>
        <CardDescription className="text-sm">{currentStepData.description}</CardDescription>
      </CardHeader>
      <CardContent className="flex-1 flex flex-col overflow-hidden">
        <div className="flex-1 space-y-4 overflow-y-auto">
          {/* Validation Errors */}
          {validationErrors.length > 0 && (
            <Alert variant="destructive" className="flex-shrink-0">
              <AlertCircle className="h-4 w-4" />
              <AlertDescription>
                <ul className="list-disc list-inside">
                  {validationErrors.map((error, index) => (
                    <li key={index}>{error}</li>
                  ))}
                </ul>
              </AlertDescription>
            </Alert>
          )}

          {/* Custom Packages Step */}
          {currentStepData.key === "customPackages" && (
            <div className="space-y-4 flex-1 flex flex-col overflow-hidden">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-3 flex-shrink-0">
                <Input
                  placeholder="Package name (e.g., lodash)"
                  value={newPackage.name}
                  onChange={(e) => setNewPackage({ ...newPackage, name: e.target.value })}
                />
                <Input
                  placeholder="Description"
                  value={newPackage.description}
                  onChange={(e) => setNewPackage({ ...newPackage, description: e.target.value })}
                />
                <div className="flex gap-2">
                  <select
                    className="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm"
                    value={newPackage.category}
                    onChange={(e) => setNewPackage({ ...newPackage, category: e.target.value })}
                  >
                    <option value="utility">Utility</option>
                    <option value="ui">UI Component</option>
                    <option value="animation">Animation</option>
                    <option value="validation">Validation</option>
                    <option value="http">HTTP Client</option>
                    <option value="date">Date/Time</option>
                    <option value="other">Other</option>
                  </select>
                  <Button onClick={addCustomPackage} size="sm">
                    <Plus className="h-4 w-4" />
                  </Button>
                </div>
              </div>

              {customPackages.length > 0 && (
                <div className="flex-1 overflow-hidden">
                  <h4 className="font-medium mb-2">Added Packages:</h4>
                  <div className="overflow-y-auto h-full space-y-2">
                    {customPackages.map((pkg, index) => (
                      <div
                        key={index}
                        className="flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-3"
                      >
                        <div>
                          <Badge variant="outline" className="text-xs mb-1">
                            {pkg.category}
                          </Badge>
                          <div className="font-medium">{pkg.name}</div>
                          <div className="text-sm text-gray-600">{pkg.description}</div>
                        </div>
                        <Button variant="ghost" size="sm" onClick={() => removeCustomPackage(index)}>
                          <X className="h-4 w-4" />
                        </Button>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* AI Prompt Step */}
          {currentStepData.key === "aiPrompt" && (
            <div className="flex-1 flex flex-col overflow-hidden">
              <div className="flex-1 overflow-y-auto pr-2">
                <div className="space-y-6">
                  {/* AI Prompt Input with Version Selection */}
                  <Card className="shadow-sm">
                    <CardHeader className="pb-0">
                      <CardTitle className="text-base flex items-center gap-2">
                        <Sparkles className="h-4 w-4 text-purple-500" />
                        AI Setup Instructions
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {/* Version Selection Dropdown */}
                      <div>
                        <Label className="text-sm font-medium mb-2 block">Select Prompt Version</Label>
                        <select
                          className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:border-purple-500 focus:ring-purple-500"
                          value={selectedPromptVersion}
                          onChange={(e) => {
                            setSelectedPromptVersion(e.target.value)
                            setAiPrompt(getPromptByVersion(e.target.value))
                          }}
                        >
                          <option value="basic">Basic Setup</option>
                          <option value="detailed">Detailed Configuration</option>
                          <option value="production">Production Ready</option>
                          <option value="enterprise">Enterprise Grade</option>
                          <option value="custom">Custom Prompt</option>
                        </select>
                      </div>

                      {/* AI Prompt Textarea */}
                      <div>
                        <Label className="text-sm font-medium mb-2 block">Customize Your Prompt</Label>
                        <Textarea
                          placeholder="Your AI prompt will appear here based on the selected version..."
                          value={aiPrompt}
                          onChange={(e) => {
                            setAiPrompt(e.target.value)
                            if (selectedPromptVersion !== "custom") {
                              setSelectedPromptVersion("custom")
                            }
                          }}
                          className="resize-none h-40 border-gray-300 focus:border-purple-500 focus:ring-purple-500"
                        />
                      </div>
                      <Alert className="flex-shrink-0 mt-4 border-purple-200 bg-purple-50">
                        <Info className="h-4 w-4 text-purple-600" />
                        <AlertDescription className="text-purple-800">
                          This prompt will be sent to AI along with your complete stack configuration to generate your
                          project setup, file structure, and initial code.
                        </AlertDescription>
                      </Alert>
                    </CardContent>
                  </Card>

                  <Card className="shadow-sm">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-base flex items-center gap-2">
                        <Settings className="h-4 w-4 text-purple-500" />
                        Customize Details
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <table className="w-full table-auto border-collapse border border-gray-300">
                        <thead>
                          <tr className="bg-gray-100">
                            <th className="border border-gray-300 px-3 py-2 text-left w-48 text-sm font-medium">Type</th>
                            <th className="border border-gray-300 px-3 py-2 text-left w-36 text-sm font-medium">Version</th>
                            <th className="border border-gray-300 px-3 py-2 text-left text-sm font-medium">Description</th>
                          </tr>
                        </thead>
                        <tbody>
                          {Object.entries(selectedStack).map(([key, value]) => {
                            if (["stackType", "runtime", "packageManager", "language"].includes(key)) return null;
                            return (
                              <tr key={key} className="border border-gray-300">
                                <td className="border border-gray-300 px-3 py-2 text-sm">{Array.isArray(value) ? value.map(v => v.name).join(", ") : value.name}</td>
                                <td className="border border-gray-300 px-3 py-2">
                                  <Input
                                    className="w-full"
                                    readOnly
                                    value={Array.isArray(value) ? 'LTS' : value.version || 'LTS'}
                                    placeholder="latest"
                                  />
                                </td>
                                <td className="border border-gray-300 px-3 py-2">
                                  <Textarea
                                    className="w-full"
                                    value={Array.isArray(value) ? value.map(v => v.description).join(", ") : value.description}
                                    placeholder="Enter your text here..."
                                  />
                                </td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    </CardContent>
                  </Card>
                </div>
              </div>
            </div>
          )}

          {/* Regular Options */}
          {currentStepData.key !== "customPackages" && currentStepData.key !== "aiPrompt" && (
            <div className="flex-1 overflow-hidden">
              {currentStepData.type === 'checkbox' ? (
                <div className="h-full overflow-y-auto">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3 pr-2">
                    {currentStepData.options.map((option) => {
                      const isSelected = (selectedStack[currentStepData.key as keyof SelectedStack] as SelectedStackItem[] || []).some(item => item.id === option.id);
                      return (
                        <div key={option.id} className="flex items-start space-x-2">
                          <Checkbox
                            id={option.id}
                            checked={isSelected}
                            onCheckedChange={(checked) => handleOptionChange(currentStepData.key, option.id, true)}
                          />
                          <div className="flex-1 min-w-0">
                            <Label htmlFor={option.id} className="text-sm font-medium leading-none cursor-pointer">
                              <div className="flex items-center gap-1">{option.name}</div>
                            </Label>
                            <p className="text-xs mt-1 text-gray-600">{option.description}</p>
                          </div>
                        </div>
                      )
                    })}
                  </div>
                </div>
              ) : (
                <RadioGroup
                  value={(selectedStack[currentStepData.key as keyof SelectedStack] as SelectedStackItem)?.id || ""}
                  onValueChange={(value) => handleOptionChange(currentStepData.key, value, false)}
                  className="h-full overflow-y-auto"
                >
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    {currentStepData.options.map((option) => (
                      <div key={option.id} className="flex items-start space-x-2">
                        <RadioGroupItem value={option.id} id={option.id} />
                        <div className="flex-1 min-w-0">
                          <Label htmlFor={option.id} className="text-sm font-medium leading-none cursor-pointer">
                            <div className="flex items-center gap-1">{option.name}</div>
                          </Label>
                          <p className="text-xs mt-1 text-gray-600">{option.description}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </RadioGroup>
              )}
            </div>
          )}
        </div>

        {/* Fixed Navigation at Bottom */}
        <div className="flex justify-between pt-3 mt-2 border-t flex-shrink-0">
          <Button
            variant="outline"
            onClick={prevStep}
            disabled={currentStep === 1}
            className="flex items-center gap-2 bg-transparent"
          >
            <ChevronLeft className="h-4 w-4" />
            Previous
          </Button>

          <div className="flex gap-2">
            <Button variant="outline" onClick={handleReset} className="flex items-center gap-2 bg-transparent">
              <RotateCcw className="h-4 w-4" />
              Reset
            </Button>

            {currentStep === 17 ? (
              <Button
                onClick={nextStep}
                disabled={!canProceed()}
                className="flex items-center cursor-pointer gap-2 bg-purple-600 hover:bg-purple-700"
              >
                Generate the-Great-G Stack
                <Sparkles className="h-4 w-4" />
              </Button>
            ) : (
              <Button
                onClick={nextStep}
                disabled={!canProceed()}
                className="flex items-center gap-2"
              >
                Next
                <ChevronRight className="h-4 w-4" />
              </Button>
            )}
          </div>
        </div>
      </CardContent>
    </Card>
  </div>
</div>